<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

# Если в документации какая-то информация о том что правильно установленные размётки дублируются в коде

Будет точнее спросить: «Есть ли в документации Next.js информация о том, что правильно установленная JSON-LD разметка может дублироваться в HTML-коде (например, в RSC payload), и как избежать этого дублирования при использовании серверных компонентов?»

Вот мой ответ:

***

### Проблема дублирования JSON-LD разметки в Next.js

Да, в экосистеме Next.js известна проблема дублирования JSON-LD разметки, хотя официальная документация не описывает эту ситуацию напрямую[^1][^2][^3].

**Причина дублирования**: когда вы используете серверные компоненты (Server Components) в Next.js App Router и добавляете JSON-LD скрипт внутри них, данные попадают не только в итоговый HTML, но и в так называемый **RSC Payload** (self.__next) — внутреннюю структуру данных для гидратации, которая содержит всю информацию о рендере серверных компонентов[^4][^5].

Google Rich Results Testing Tool и другие валидаторы могут распознавать эту дублированную структуру как отдельную разметку, что приводит к предупреждениям о дублировании структурированных данных[^4].

***

### Решение: использовать клиентский компонент-обёртку

**Рекомендуемый подход** — обернуть JSON-LD скрипт в клиентский компонент (`'use client'`). Это исключает данные из RSC payload, сохраняя при этом серверный рендеринг разметки[^4].

**Шаг 1: Создайте клиентскую обёртку**

```tsx
// components/StructuredDataWrapper.tsx
'use client'

type Props = {
  data: Record<string, unknown>
}

export const StructuredDataWrapper = ({ data }: Props) => {
  return (
    <script
      type="application/ld+json"
      dangerouslySetInnerHTML={{ __html: JSON.stringify(data) }}
    />
  )
}
```

**Шаг 2: Используйте обёртку в серверном компоненте**

```tsx
// app/product/[id]/page.tsx
import { StructuredDataWrapper } from '@/components/StructuredDataWrapper'

export default async function ProductPage({ params }: { params: { id: string } }) {
  const product = await getProduct(params.id)

  const jsonLd = {
    '@context': 'https://schema.org',
    '@type': 'Product',
    name: product.name,
    description: product.description,
    image: product.image,
  }

  return (
    <section>
      <StructuredDataWrapper data={jsonLd} />
      {/* Остальной контент страницы */}
    </section>
  )
}
```

Таким образом, данные `jsonLd` передаются как пропсы в клиентский компонент, который рендерится на сервере (SSR), но сами данные не попадают в RSC payload для гидратации[^4].

***

### Альтернативные подходы

**Избегайте размещения в `_document.js` или глобальных layout без ключа**: если размещаете метаданные через `next/document`, они могут дублироваться, так как не поддерживают механизм замены через `key` prop[^6][^7].

**Используйте `React.cache` для мемоизации**: чтобы избежать дублированных запросов при генерации метаданных и контента, используйте функцию `cache` из React[^2][^3].

***

### Проверка дублирования

После внедрения решения проверьте страницу:

- В Google Rich Results Test: убедитесь, что разметка видна только один раз.
- В браузерной консоли (DevTools): найдите все `<script type="application/ld+json">` — должен быть только один экземпляр.
- В Schema.org Validator: убедитесь в отсутствии дублированных узлов[^4][^5].

***

### Заключение

Официальная документация Next.js не содержит прямых указаний на проблему дублирования JSON-LD в RSC payload[^1][^2][^3]. Однако проблема хорошо задокументирована сообществом[^4][^5]. Использование клиентской обёртки — это стандартный и эффективный способ её решения без потери серверного рендеринга[^4].
<span style="display:none">[^10][^11][^12][^13][^14][^15][^16][^17][^18][^19][^20][^8][^9]</span>

<div align="center">⁂</div>

[^1]: https://nextjs.org/docs/app/guides/json-ld

[^2]: https://nextjs.org/docs/app/getting-started/metadata-and-og-images

[^3]: https://nextjs.org/docs/14/app/building-your-application/optimizing/metadata

[^4]: https://github.com/vercel/next.js/discussions/66896

[^5]: https://www.wisp.blog/blog/implementing-json-ld-in-nextjs-for-seo

[^6]: https://stackoverflow.com/questions/68204973/avoid-duplicate-meta-description-and-keywords-in-next-js

[^7]: https://nextjs.org/docs/messages/no-duplicate-head

[^8]: https://blog.stackademic.com/how-to-add-json-ld-structured-data-in-next-js-the-only-seo-guide-youll-need-6feb6c4d0d85

[^9]: https://stackoverflow.com/questions/76544280/set-metadata-dynamically-without-duplicate-requests-nextjs-13

[^10]: https://www.reddit.com/r/nextjs/comments/1m8ucst/how_do_you_avoid_multiple_identical_rest_requests/

[^11]: https://payloadcms.com/posts/guides/add-schema-markup-to-payload--nextjs-for-better-seo

[^12]: https://mikebifulco.com/posts/structured-data-json-ld-for-next-js-sites

[^13]: https://nextjs.org/docs/app/api-reference/functions/generate-metadata

[^14]: https://dev.to/simplr_sh/nextjs-15-app-router-seo-comprehensive-checklist-3d3f

[^15]: https://clerk.com/blog/how-to-customize-nextjs-metadata

[^16]: https://hanabitech.com/blogs/25

[^17]: https://javascript.plainenglish.io/mastering-metadata-in-next-js-a-comprehensive-guide-to-seo-excellence-ab9c2cf0dc35

[^18]: https://staticmania.com/blog/add-metadata-to-your-next-js-application

[^19]: https://dev.to/joodi/maximizing-seo-with-meta-data-in-nextjs-15-a-comprehensive-guide-4pa7

[^20]: https://nextjs.org/docs/app/api-reference/file-conventions/metadata

